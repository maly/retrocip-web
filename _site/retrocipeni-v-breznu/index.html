<!DOCTYPE html>
<html lang="cs-CZ">
  <!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Retročipení v březnu</title>

  

  <meta name="description" content="Ruka, oko, noha… Tedy pardon: výstava, hraní s displejem a hraní s klávesnicí. V Praze se konala konference Devel a já byl požádán nejmenovaným operátorem O2, zdali bych pro ně mohl na tuto akci připravit něco, co by spojovalo starou a novou techniku. Chvilku jsme si ujasňovali, co by to...">

  

  

  <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  <meta property="og:title" content="Retročipení v březnu">
  <meta property="og:description" content="Ruka, oko, noha… Tedy pardon: výstava, hraní s displejem a hraní s klávesnicí. V Praze se konala konference Devel a já byl požádán nejmenovaným operátorem O2, zdali bych pro ně mohl na tuto akci připravit něco, co by spojovalo starou a novou techniku. Chvilku jsme si ujasňovali, co by to...">

  
  <meta property="og:image" content="http://localhost:4000/wp-content/uploads/sites/6/favicon/retrocip.png">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="">
  <meta property="og:article:published_time" content="2016-03-28T14:18:28+02:00">
  <meta property="og:url" content="http://localhost:4000/retrocipeni-v-breznu/">
  <link rel="canonical" href="http://localhost:4000/retrocipeni-v-breznu/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@retrocip">
  <meta name="twitter:creator" content="@retrocip">

  <meta property="twitter:title" content="Retročipení v březnu">
  <meta property="twitter:description" content="Ruka, oko, noha… Tedy pardon: výstava, hraní s displejem a hraní s klávesnicí. V Praze se konala konference Devel a já byl požádán nejmenovaným operátorem O2, zdali bych pro ně mohl na tuto akci připravit něco, co by spojovalo starou a novou techniku. Chvilku jsme si ujasňovali, co by to...">

  
  <meta name="twitter:image" content="http://localhost:4000/wp-content/uploads/sites/6/favicon/retrocip.png">
  

  


  

  

</head>


  <body>
    
 <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="https://beautifuljekyll.com">Beautiful Jekyll</a>
                  <a class="dropdown-item" href="https://www.markdowntutorial.com/">Learn markdown</a>
            </div>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="https://deanattali.com">Author's home</a>
          </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="http://localhost:4000/">
          <img alt="Navigation bar avatar" class="avatar-img" src="/wp-content/uploads/sites/6/favicon/retrocip.png" />
        </a>
      </div>
    </div>
  

</nav>
 <!-- TODO this file has become a mess, refactor it -->
<!-- prettier-ignore -->

  



<header class="header-section ">
  
  <div class="intro-header no-img">
    <div class="container-md">
      <div class="row">
        <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
          <div class="post-heading">
            <h1>
              Retročipení v březnu
            </h1>
             
            <span class="post-meta"
              >Vydáno 28. 3. 2016</span
            >
              
          </div>
        </div>
      </div>
    </div>
  </div>
</header>




<div
  class=" container-md "
>
  <div class="row">
    <div
      class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 "
    >
       

      <article role="main" class="blog-post"><p>Ruka, oko, noha… Tedy pardon: výstava, hraní s displejem a hraní s klávesnicí.</p>

<!--more-->

<p>V Praze se konala konference Devel a já byl požádán nejmenovaným operátorem O2, zdali bych pro ně mohl na tuto akci připravit něco, co by spojovalo starou a novou techniku. Chvilku jsme si ujasňovali, co by to asi tak mělo být, nápad pustit mezi geeky drona, řízeného starým Commodorem, jsem zavrhl (dovedete si představit ten žižkovský masakr roztočenou vrtulí?) a nakonec jsme se shodli na robotické ruce, řízené starým Didaktikem.</p>

<p>Jenže času nebylo nazbyt, ruka se stále ne a ne objevit, a pak se objevila. Přiložené Botboarduino bylo skvělé, ale bohužel nereagovalo na jakékoli pokusy o naprogramování. Čas se chýlil a chýlil… Narychlo jsem koupil servo shield od Adafruit a přidal vlastní Arduino. [sc:ebay item=“Adafruit 16-Channel 12-bit PWM Servo shield I2C“]</p>

<p>Pak už se ruka hýbala. Bohužel jsem si neuvědomil, že při prvním spuštění, když se serva dostávají do definované polohy, sebou tak jako mocně škubnou, navíc v tom robotu jich je hned několik, a hodně silných, takže ta škuba byla opravdu velkolepá, a já dostal poprvé ve svém životě přes hubu od robota… Naštěstí opět zvítězil lidský intelekt nad hrubou silou, a pak už jen poslušně mávala a manipulovala.</p>

<p>Připojení k Didaktiku bylo pak docela prosté. Didaktik má vyvedený interface od 8255. Dva piny (PC4 a PC7, kdyby vás to zajímalo) jsem vyhradil pro komunikaci s Arduinem. Po jednom jde čas, po druhém data, a víceméně jsem simuloval něco jako SPI. A jelikož bylo málo času na rozchození, tak jsem to z Didaktika pouštěl v BASICu. Nahrubo. OUT, OUT, OUT… a jedem.</p>

<p>Šlo by to určitě i jinak. Třeba z toho Didaktika rovnou ovládat servo shield. A přepsat rutiny do strojáku. Jasně že by to všechno šlo, jenom ten čas se chýlil a chýlil a kvačil… Ale nakonec to dobře dopadlo.</p>

<p>Na akci jsem přivezl i několik starších kousků, zapojil jsem je k televizím a nechal jsem návštěvníky, ať si hrají.</p>

<div id="gallery-10" class="gallery galleryid-765 gallery-columns-3 gallery-size-thumbnail gallery1">
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/600684_10153515387422496_4756415373634951829_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption772'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/600684_10153515387422496_4756415373634951829_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12523892_10153515387477496_7505419680903680049_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption773'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12523892_10153515387477496_7505419680903680049_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10387702_10153515387367496_7573605468496318499_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption771'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10387702_10153515387367496_7573605468496318499_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <br style="clear: both" />
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10407032_10153515386967496_8320520211423998695_n.jpg" title="Retročipařská výstavka na Devel 2016" class="highslide" onclick="return hs.expand(this,{captionId:'caption766'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10407032_10153515386967496_8320520211423998695_n-150x150.jpg" width="150" height="150" alt="Retročipařská výstavka na Devel 2016" /></a>
    </dt>
    
    <dd class="gallery-caption" id="caption766">
      <span class="imagecaption">Retročipařská výstavka na Devel 2016</span><br />
    </dd>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12189961_10153515387057496_515566159307672223_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption767'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12189961_10153515387057496_515566159307672223_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/970469_10153515387212496_5793808113455511761_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption768'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/970469_10153515387212496_5793808113455511761_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <br style="clear: both" />
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/1924004_10153515387277496_7446025834420251948_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption769'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/1924004_10153515387277496_7446025834420251948_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12143064_10153515387312496_340425830953014266_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption770'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12143064_10153515387312496_340425830953014266_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12107773_10153515387612496_8722114112772120592_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption774'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/12107773_10153515387612496_8722114112772120592_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <br style="clear: both" />
  
  <dl class="gallery-item">
    <dt class="gallery-icon">
      <a href="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10612673_10153515387652496_502823875489423105_n.jpg" title="" class="highslide" onclick="return hs.expand(this,{captionId:'caption775'})"><img src="http://retrocip.cz/wp-content/uploads/sites/6/2016/03/10612673_10153515387652496_502823875489423105_n-150x150.jpg" width="150" height="150" alt="" /></a>
    </dt>
  </dl>
  
  <br style="clear: both" />
</div>

<p>—</p>

<p>S Michalem Průšou jsme před časem řešili problém, jak předejít rušení na přívodech k displeji u 3D tiskárny. Displej je klasický 20×4 s HD řadičem, a je řízený pomocí čtyřbitového rozhraní. [sc:ebay item=“20×4 display module backlight“]</p>

<p>Bohužel, ty čtyři bity (a další řídicí signály) jsou vedené plochým kabelem asi 30 cm na délku, a to je docela dost. Funguje to, ale ne stoprocentně. Lepší by bylo nějaké sériové vedení signálu… Michal navrhoval nějaký posuvný registr s latchem, třeba 74HC595, já navrhoval použít speciální řešení s PCF8574. [sc:ebay item=“display I2C 1602 2004 module“]</p>

<p>Teď před víkendem přišel, a kupodivu fungoval na první zapojení. S drobnou výhradou teda – nejdřív jsem myslel, že nefunguje, ale stačilo poštelovat trimr, který řídí kontrast, a hned bylo dobře…</p>

<p>—</p>

<p>A když už jsem měl u Arduina ten hezký displej, tak jsem si vzpomněl na svou letitou ideu udělat nějaký retrohold starým kapesním počítačům SHARP PC, kde byla QWERTY klávesnice, dvou- nebo čtyřřádkový LCD displej a zadrátovaný BASIC, a hleděl jsem připojit PS/2 klávesnici k Arduinu. [sc:ebay item=“ps2 keyboard module“]</p>

<p>Ne že by to nešlo. Jde to. Ne že by to nikdo nezkoušel. Zkoušeli to. Ale ta knihovna, kterou jsem našel a která se hojně používá, má takový jeden nešvar: Moc to neumí. Snaží se překódovat scankódy na ASCII, ale trošku to dře.</p>

<p>Totiž, pokud nevíte, jak taková PS/2 klávesnice komunikuje, tak vězte, že to není moc hezké. Připojené to je přes dva signály – hodiny a data. To je OK. Hodiny řídí klávesnice. To už není tak OK, protože to znamená, že buď musíte obětovat jeden vstup se schopností vyvolat přerušení při sestupné hraně, nebo musíte neustále sledovat dění na pinu a ztrácíte tak výkon… Jo a ten protokol, co vám jde, tak tam samozřejmě jdou jen scankódy, tedy vlastně jakási čísla kláves. Jeden scankód přijde, když je klávesa stisknutá, druhý, když ji pustíte. To, jaké znaky a významy jim přiřadíte, je už zcela na vás.</p>

<p>No a jestli si myslíte, že LEDky blikají díky magii a že třeba Caps Lock si klávesnice rozsvítí sama poté, co zmáčknete tlačítko Caps Lock, tak jste na omylu, protože LEDky řídí počítač pomocí příkazů, co do klávesnice posílá. Nejdřív si sebere oba signály pro sebe, pak pošle definovanou sekvenci, která řekne klávesnici, že následuje příkaz, a pak pustí hodiny (=nastaví opět na příjem). Klávesnice začne generovat hodinové pulsy, vy po datovém výstupu posíláte data, po devíti bitech (8+lichá parita) přepnete data na vstup, počkáte si na potvrzení, a pak vám klávesnice pošle na oplátku informaci o tom, že rozuměla.</p>

<p>Což skvěle fungovalo do soboty, 15:00. LEDky blikaly, klávesnice odpovídala jak má, tedy 0xFA, jako že rozuměla, a pak jsem zkusil poslat dvě změny LEDek po sobě. A najednou se to celé úplně… napsal bych rozbilo, ale to je málo pro to, co se stalo. Ono se to celé rozesralo! Příjem od klávesnice byl o bit posunutý, klávesnice najednou vracela úplně nesmyslné kódy, na příkazy reagovala statusem 0xFC, a tak jsem ladil a posouval a ošetřoval, kontroloval jsem, jestli nechodí nějaké falešné přerušení, nuloval jsem počítadla bitů, RESETy jsem posílal, a nic, přátelé, ani ťuk!</p>

<p>Takže nakonec mám <a href="https://github.com/maly/PS2KeyboardPlus">knihovnu</a>, která umí krásně číst scankódy, včetně těch rozšířených, umí poslat Arduinu zprávu onPress a onRelease, ale nebliká, přátelé, nebliká! 🙁</p>

<p>A to jsem se s tím crcal ještě půl neděle!</p>

<p>Ale co, aspoň ty scankódy mám, krok 2 pak může být jejich překlad na ASCII znaky. Tralala… Někdy příště!</p>
</article>

      
      <div class="blog-tags">
        <span>Tagy:</span>
        
        <a href="/tags#arduino">arduino</a>
        
        <a href="/tags#Commodore">Commodore</a>
        
        <a href="/tags#Didaktik">Didaktik</a>
        
        <a href="/tags#displej">displej</a>
        
        <a href="/tags#klávesnice">klávesnice</a>
        
        <a href="/tags#PS/2">PS/2</a>
        
        <a href="/tags#Roboti">Roboti</a>
        
        <a href="/tags#servo">servo</a>
        
        <a href="/tags#Sinclair">Sinclair</a>
        
      </div>
         <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=Retro%C4%8Dipen%C3%AD+v+b%C5%99eznu&url=http%3A%2F%2Flocalhost%3A4000%2Fretrocipeni-v-breznu%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fretrocipeni-v-breznu%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fretrocipeni-v-breznu%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

</section>


 

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a
            class="page-link"
            href="/jeste-ze-tam-byla-z80/"
            data-toggle="tooltip"
            data-placement="top"
            title="&#8222;Ještě že tam byla Z80!&#8220;"
            >&larr; Předchozí</a
          >
        </li>
         
        <li class="page-item next">
          <a
            class="page-link"
            href="/vyukovy-shield-pro-arduino-dil-prvni/"
            data-toggle="tooltip"
            data-placement="top"
            title="Výukový shield pro Arduino, díl první"
            >Následující &rarr;</a
          >
        </li>
        
      </ul>
      
  
  
  

  




    </div>
  </div>
</div>
 <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:retrocip@maly.cz" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://www.facebook.com/martin.maly" title="Facebook">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Facebook</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/maly" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/retrocip" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
      2020

      
        &nbsp;&bull;&nbsp;
        <span class="author-site">
          <a href="http://localhost:4000/">Retročip.cz</a>
        </span>
      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>
 
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  








  </body>
</html>
